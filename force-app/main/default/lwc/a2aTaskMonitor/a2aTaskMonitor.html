<template>
    <lightning-card title="A2A Task Monitor" icon-name="standard:task">
        <lightning-button-icon 
            icon-name="utility:refresh" 
            variant="border-filled" 
            onclick={handleRefresh} 
            slot="actions"
            alternative-text="Refresh">
        </lightning-button-icon>
        
        <div class="slds-p-horizontal_medium">
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
            </template>
            
            <template if:false={isLoading}>
                <template if:true={hasTasks}>
                    <div class="slds-m-bottom_medium">
                        <lightning-pill-container>
                            <template for:each={statusFilters} for:item="filter">
                                <lightning-pill 
                                    key={filter.value}
                                    label={filter.label}
                                    name={filter.value}
                                    variant={filter.variant}
                                    onclick={handleFilterClick}>
                                    <lightning-icon 
                                        icon-name={filter.icon} 
                                        variant={filter.iconVariant}
                                        slot="icon">
                                    </lightning-icon>
                                </lightning-pill>
                            </template>
                        </lightning-pill-container>
                    </div>
                    
                    <lightning-datatable
                        key-field="id"
                        data={filteredTasks}
                        columns={columns}
                        onrowaction={handleRowAction}
                        show-row-number-column
                        hide-checkbox-column>
                    </lightning-datatable>
                </template>
                
                <template if:false={hasTasks}>
                    <div class="slds-align_absolute-center slds-p-vertical_large">
                        <div class="slds-text-align_center">
                            <lightning-icon 
                                icon-name="standard:task" 
                                size="large" 
                                variant="inverse"
                                class="slds-m-bottom_medium">
                            </lightning-icon>
                            <p class="slds-text-heading_medium">No Tasks Found</p>
                            <p class="slds-text-body_regular slds-m-top_small">
                                Tasks will appear here when agents process messages
                            </p>
                        </div>
                    </div>
                </template>
            </template>
        </div>
        
        <template if:true={selectedTask}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                                title="Close" 
                                onclick={closeModal}>
                            <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                        </button>
                        <h2 class="slds-text-heading_medium">Task Details</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium">
                        <dl class="slds-list_horizontal slds-wrap">
                            <dt class="slds-item_label slds-text-color_weak">Task ID:</dt>
                            <dd class="slds-item_detail">{selectedTask.id}</dd>
                            
                            <dt class="slds-item_label slds-text-color_weak">Status:</dt>
                            <dd class="slds-item_detail">
                                <lightning-badge label={selectedTask.status} variant={selectedTask.statusVariant}></lightning-badge>
                            </dd>
                            
                            <dt class="slds-item_label slds-text-color_weak">Created:</dt>
                            <dd class="slds-item_detail">
                                <lightning-formatted-date-time 
                                    value={selectedTask.createdAt}
                                    year="numeric"
                                    month="short"
                                    day="2-digit"
                                    hour="2-digit"
                                    minute="2-digit">
                                </lightning-formatted-date-time>
                            </dd>
                            
                            <dt class="slds-item_label slds-text-color_weak">Updated:</dt>
                            <dd class="slds-item_detail">
                                <lightning-formatted-date-time 
                                    value={selectedTask.updatedAt}
                                    year="numeric"
                                    month="short"
                                    day="2-digit"
                                    hour="2-digit"
                                    minute="2-digit">
                                </lightning-formatted-date-time>
                            </dd>
                        </dl>
                        
                        <template if:true={selectedTask.artifacts}>
                            <div class="slds-m-top_medium">
                                <h3 class="slds-text-heading_small slds-m-bottom_small">Artifacts</h3>
                                <pre class="slds-box">{selectedTask.artifactsJson}</pre>
                            </div>
                        </template>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick={closeModal}>Close</button>
                        <template if:true={canCancelTask}>
                            <button class="slds-button slds-button_destructive" onclick={handleCancelTask}>Cancel Task</button>
                        </template>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
    </lightning-card>
</template>